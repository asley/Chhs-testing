{#<!--
name: Attendance - Fixed with Debug
category: Student Data
types: Body
sources:
    student: Student
    attendance: AttendanceByCycle
    reportingCycle: ReportingCycle
config:
    includePresent:
        label: Include Present?
        type: yesno
        default: Y
    limitByReportingCycle:
        label: Show Only Current Cycle?
        type: yesno
        default: Y
-->#}
{{- stylesheet ? include(stylesheet) -}}

<style>
    .attendance {
        font-size: 8pt;
        text-align: center;
        line-height: 1.4;
    }
</style>


{% if reportingCycle %}
<table class="w-full table" cellspacing="0" cellpadding="4" nobr="true">
    <tr>
        {% if config.limitByReportingCycle == 'Y' %}
        {# Show only current cycle #}
        {% set cycleName = reportingCycle.cycles[reportingCycle.cycleNumber] %}
        <td class="header bg-primary border" style="width:100%; line-height: 1.9; text-align: center;"
            colspan="{{ config.includePresent == 'Y' ? 3 : 2 }}">{{ cycleName }} Attendance</td>
        {% else %}
        {# Show all cycles #}
        {% set width = 100 / reportingCycle.cycleTotal %}
        {% set count = config.includePresent == 'Y' ? 3 : 2 %}

        {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
        {% set cycleName = reportingCycle.cycles[cycleNum] %}
        <td class="header bg-primary border" style="width:{{ width }}%; line-height: 1.9; text-align: center;"
            colspan="{{ count }}">{{ cycleName }} Attendance</td>
        {% endfor %}
        {% endif %}
    </tr>
    <tr>
        {% if config.limitByReportingCycle == 'Y' %}
        {# Show only current cycle data #}
        {% set cycleNum = reportingCycle.cycleNumber %}
        {% if config.includePresent == 'Y' %}
        <td class="border-bottom border-left attendance" style="width:33.33%">
            <div class="subheader">Present</div>
            {{ attendance[cycleNum].present|default(0) }}
        </td>
        {% endif %}
        <td class="border-bottom attendance {{ config.includePresent != 'Y' ? 'border-left' : '' }}"
            style="width:{{ config.includePresent == 'Y' ? '33.33%' : '50%' }}">
            <div class="subheader">Absent</div>
            {{ attendance[cycleNum].absent|default(0) }}
        </td>
        <td class="border-bottom border-right attendance"
            style="width:{{ config.includePresent == 'Y' ? '33.33%' : '50%' }}">
            <div class="subheader">Late</div>
            {{ attendance[cycleNum].late|default(0) }}
        </td>
        {% else %}
        {# Show all cycles data #}
        {% set width = 100 / reportingCycle.cycleTotal %}
        {% set count = config.includePresent == 'Y' ? 3 : 2 %}

        {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
        {% if config.includePresent == 'Y' %}
        <td class="border-bottom border-left attendance" style="width:{{ width / count }}%">
            <div class="subheader">Present</div>
            {{ attendance[cycleNum].present|default(0) }}
        </td>
        {% endif %}
        <td class="border-bottom attendance {{ config.includePresent != 'Y' ? 'border-left' : '' }}"
            style="width:{{ width / count }}%">
            <div class="subheader">Absent</div>
            {{ attendance[cycleNum].absent|default(0) }}
        </td>
        <td class="border-bottom border-right attendance" style="width:{{ width / count }}%">
            <div class="subheader">Late</div>
            {{ attendance[cycleNum].late|default(0) }}
        </td>
        {% endfor %}
        {% endif %}
    </tr>
</table>
{% endif -%}

<br/>
